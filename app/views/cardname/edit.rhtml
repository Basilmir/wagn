<% slot_for(@card,@context,'name') do |slot| %>
 	<div class="name-editor edit-area">  
		<% form_remote_for :card, @card, :url=>slot.url_for('cardname/update'), 
				:update=>slot.id(:name) do |f| %>
			 
			<p>Change <%= link_to_page formal_title(@card), @card.name %> to   
			 <%= slot.name_field(f, :class=>'name-field' %>
				<% if @card.name and @card.name.junction? %>
			  	<%= button_to_function "Flip", "f=getSlotElement('name-field'); f.value = f.value.split('+').reverse().join('+')"  %>
				<% end %>
				</p>
							
			<% if @action=='confirm' %>
			  <% if dependents = @card.dependents and !dependents.empty? %>
			    <p>This will change the names of these cards, too:</p>
			    <ul>
			      <% dependents.map do |dep| %>
			        <li><%= link_to_page formal_title(dep), dep.name %>
			      <% end. join ', ' %>
			    </ul>
				  <%= hidden_field_tag 'card[confirm_rename]', 'true' %>
			  <% end %>

			  <% if children = (@card.dependents + [@card]).plot(:linkers).flatten.uniq and !children.empty? %>
			    <p>These cards are linked to from the following cards:</p>
			    <ul>
			      <% children.map do |child| %>
			        <li><%= link_to_page formal_title(child), child.name %>
			      <% end. join ', ' %>
			    </ul>
			    Would you like to 
			    <p><%= f.radio_button 'change_links_on_rename', 'yes', true %>Revise all these cards with the new link
			    <%= f.radio_button 'change_links_on_rename', 'no' %>Let the links be broken</p>
			  <% end %>
			<% end %>
			
		 	<%= submit_tag 'Rename' %>
		  <%= button_to_remote 'Cancel', :url=>slot.url_for('cardname/view'), :update=>slot.id('name-area') %>
		<% end %>
	</div>
<% end %>
