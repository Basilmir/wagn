<%-
   slot_args={}
   slot_args[:home_view] = params[:home_view] if params[:home_view]
   cancel    ||= nil
   hide_type ||= nil
   redirect  ||= nil
%>


<%= wrap_slot(slot, slot_args) do |slot| %>
    <%= error_messages_for card %>

    <%= form_for card, :url=>"/card/create", :remote=>true, :html=>{ :class=>'card-form card-new-form standard-slotter' } do |form| %>
      <%- slot.form = form %>
      <%= hidden_field_tag :home_view, params[:home_view] || :open %>
      <% if redirect %><%= hidden_field_tag :redirect, redirect %><% end %>
    
      <div class="card-header">
        <% if hide_type %>
          <%= form.hidden_field :typecode %>
        <% else %>
          <span class="new-type">
            <label>type:</label>
            <%= slot.typecode_field :class=>'cardtype-field new-cardtype-field live-cardtype-field', :href => '/card/new' %>
          </span>
        <% end %>
        
        <span class="new-name">
          <label>name:</label>
          <% if card.cardname.blank? || Card.exists?(card.cardname) %>
            <% unless card.setting_card('autoname') %>
              <span class="name-area"><%= raw slot.name_field(form) %></span>
            <% end %>
          <% else %>
            <%= hidden_field_tag 'card[name]', card.name %>
            <span class="title"><%= raw fancy_title(card.name) %></span>
          <% end %>
        </span>
      </div>

      <% if instruction=card.setting_card('add help', 'edit help')  %>
        <div class="instruction"><%= raw slot.subrenderer(instruction).render_core %></div>
      <% end %>


      <div class="edit-area">
        <div class="card-editor editor">
          <%= raw slot.render(:edit) %>
        </div>

        <div class="edit-button-area">
          <%= submit_tag 'Submit', :class=>'create-submit-button' %>
          <%= button_tag 'Cancel', :class=>"create-cancel-button standard-slotter", :type=>'button',
            :href=>"/card/view/#{card.cardname.to_url_key}?view=missing" %>
        </div>
      </div>
    <% end %>

  <%= raw slot.notice %>
<% end %>

